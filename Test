Knowledge Base Article: Rotating Passwords for Splunk UBA Users (splunkuba & splunkubatoes)

Purpose

This article provides step-by-step instructions for rotating passwords for the Splunk UBA users:

splunkuba: The search account used by UBA to query all data sources.

splunkubatoes: The output connector account that UBA uses to send data to Splunk.


Additionally, it outlines how to update the password within CyberArk and ensure the change is reflected in the UBA Output Connector configuration.


---

Prerequisites

Administrative access to Splunk UBA.

Splunk Admin privileges to update user credentials.

CyberArk access to manually maintain credentials.

ServiceNow ticket to track the password rotation.



---

Step 1: Generate a New Secure Password

Before updating Splunk and CyberArk, generate a secure password that meets security requirements.

Password Complexity Guidelines

Minimum 15 characters.

At least one uppercase letter.

At least one lowercase letter.

At least one number.

At least one special character.



---

Step 2: Rotate the Password for splunkuba in Splunk

The splunkuba account is used by UBA to search Splunk data sources.

1. Update the Password for splunkuba in Splunk

1. Log in to the Splunk instance as an administrator.


2. Run the following command via CLI:

./splunk edit user splunkuba -password "NewSecurePassword123!" -role uba_search -auth admin:<admin_password>

Replace NewSecurePassword123! with the new password.

Replace <admin_password> with your admin credentials.



3. Alternatively, update the password via Splunk Web UI:

Navigate to Settings > Access Controls > Users.

Locate splunkuba and click Edit.

Update the password and save the changes.





---

Step 3: Update the Password for splunkubatoes in Splunk

The splunkubatoes account is the output connector account used to send processed data from UBA to Splunk.

1. Update the Password for splunkubatoes in Splunk

1. Log in to the Splunk instance as an administrator.


2. Run the following command via CLI:

./splunk edit user splunkubatoes -password "NewSecurePassword123!" -role uba_output -auth admin:<admin_password>

Replace NewSecurePassword123! with the new password.

Replace <admin_password> with your admin credentials.



3. Alternatively, update the password via Splunk Web UI:

Navigate to Settings > Access Controls > Users.

Locate splunkubatoes and click Edit.

Update the password and save the changes.





---

Step 4: Update the Password in UBA

Once the passwords are changed in Splunk, update them in UBA to ensure continued functionality.

1. Update splunkuba Password in UBA

1. Log in to UBA as an administrator.


2. Navigate to Manage > System Settings > Data Sources.


3. Locate the Splunk Data Source where splunkuba is used.


4. Click Edit and update the password with the new value.


5. Save the changes.


6. Restart the UBA Data Source Connector:

systemctl restart uba-data-source



2. Update splunkubatoes Password in the UBA Output Connector

1. Log in to UBA as an administrator.


2. Navigate to Manage > System Settings > Output Connectors.


3. Locate the Splunk Output Connector where splunkubatoes is used.


4. Click Edit and update the password with the new value.


5. Save the changes.


6. Restart the UBA Output Connector:

systemctl restart uba-output-connector




---

Step 5: Update Passwords in CyberArk

After updating the passwords in Splunk and UBA, manually update them in CyberArk.

1. Log in to CyberArk

Use an authorized account to access the CyberArk Web Portal.


2. Locate the Stored Credentials

Search for the password entries for:

splunkuba

splunkubatoes



3. Update the Passwords

Select each record and click Edit.

Replace the old password with the newly generated password.

Save the changes.



---

Step 6: Validate the Change

1. Verify UBA Searches Work

In UBA, navigate to Search.

Run a test query to confirm that splunkuba can retrieve data.

Check logs for errors:

tail -f /var/log/uba/search.log


2. Verify UBA Output Connector

In UBA, navigate to Manage > System Status.

Ensure the Splunk Output Connector is running without errors.

Check logs:

tail -f /var/log/uba/output.log


3. Validate in CyberArk

Ensure passwords in CyberArk match the updated ones.



---

Step 7: Document and Close ServiceNow Ticket

1. Update the ServiceNow ticket with:

Confirmation that the password was successfully rotated.

The verification steps completed.

Any issues encountered and resolved.



2. Close the ServiceNow ticket once validated.




---

Troubleshooting

1. UBA Fails to Search Splunk Data

Check splunkuba's authentication status:

cat /var/log/uba/search.log | grep "authentication failure"

Ensure the password was updated in UBA Data Sources.

Restart the UBA Data Source service:

systemctl restart uba-data-source


2. UBA Output Connector Fails to Send Data

Check splunkubatoes credentials in UBA Output Connectors.

Restart the UBA Output Connector service:

systemctl restart uba-output-connector


3. Password Sync Issues Between Splunk & CyberArk

Verify that the password stored in CyberArk matches what was set in Splunk and UBA.



---

Audit & Compliance

Password rotations must be logged in ServiceNow.

CyberArk must maintain a version history of changes.

Ensure Splunk and UBA logs do not show authentication failures.



---

Conclusion

Rotating passwords for Splunk UBA users (splunkuba and splunkubatoes) is critical for security and compliance. Follow this process to:

Update passwords in Splunk.

Update UBA Data Sources and Output Connectors.

Maintain records in CyberArk.

Ensure proper functionality after the change.


By following these steps, you can successfully rotate passwords with minimal downtime.

